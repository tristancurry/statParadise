<!DOCTYPE html>
<html>
  
<head>
<meta charset="utf-8">
<title>StatParadise</title>
<style>
canvas {
    border: 3px #CCC solid;
}
</style>
</head>
<body>

<h1 id="theTitle">Stats</h1>
<h2 id="status">0 | 0</h2>

<div id="container">
    <canvas id="myCanvas" height="450" width="450"></canvas>
</div>

<p id="Statistics"></p>

<div>
<input type="range" id="proportion"  value="50">

<p id="demo"></p>

<input type="range" id="trail"  value="97">

<p id="trails"></p>

<input type="range" id="part"  value="85">

<p id="partNumber"></p>
</div>

<script>
	
	var mouseX = 0;
	var mouseY = 0;
	
	var title = document.querySelector("#theTitle");
	var stats = document.querySelector("#Statistics");
	var mainCanvas = document.querySelector("#myCanvas");
	var mainContext = mainCanvas.getContext("2d");
	mainCanvas.addEventListener('mousemove', function(event){
			mouseX = event.pageX - mainCanvas.offsetLeft;
			mouseY = event.pageY - mainCanvas.offsetTop;
			var status = document.getElementById('status');
			status.innerHTML = mouseX + " | " + mouseY
	});
	
	var canvasWidth = mainCanvas.width;
	var canvasHeight = mainCanvas.height;
	
	var particles = new Array();
	var xCounter = 0;
var yCounter = 0;


	var requestAnimationFrame = window.requestAnimationFrame || 
                            window.mozRequestAnimationFrame || 
                            window.webkitRequestAnimationFrame || 
                            window.msRequestAnimationFrame;
							
							

					


							

//Object definitions							
							
function Member(posX, posY, size, shade) {
	

	this.posX = posX;
	this.posY = posY;
	this.size = size;
	this.shade = shade;

	
	
	this.fillStyle = "rgba(" + this.shade +"," + this.shade +"," + this.shade +",1)";
	

	
	this.render = function(){

		mainContext.beginPath();
		mainContext.arc(this.posX, this.posY, this.size, 0, 2*Math.PI, false);
		mainContext.closePath();
		mainContext.fillStyle = this.fillStyle;
		mainContext.fill();
		
	}

}

//functions



function drawParticles(){

var avgSize = 0;
var stdSize = 0;
var avgShade = 0;
var stdShade = 0;

var xIncrement = Math.floor((canvasWidth-20)/10);
var yIncrement = Math.floor(canvasWidth/10);

xCounter = xCounter + xIncrement;


if(xCounter > canvasWidth){
xCounter = xIncrement;
yCounter = yCounter + yIncrement;
}

var g = getTrailLength();
//mainContext.fillStyle = "rgba(20,20,20," + g + ")";
//mainContext.fillRect(0, 0, canvasWidth, canvasHeight);
		
if(particles.length < /*getParticleNumber()*/ 100){
createParticle(xCounter, yCounter);
}

	for(var i = 0; i < particles.length; i++) {
		var myParticle = particles[i];
		myParticle.render();
		if(particles.length > 0){
			avgSize = avgSize + (1.0/particles.length)*myParticle.size;
			avgShade = avgShade + (1.0/particles.length)*myParticle.shade;
		}		

	}
	
	for(var i = 0; i < particles.length; i++) {
		var myParticle = particles[i];
		if(particles.length > 1){
			stdSize = stdSize + (1/(particles.length - 1))*Math.pow(myParticle.size - avgSize,2);
			stdShade = stdShade + (1/(particles.length - 1))*Math.pow(myParticle.shade - avgShade,2);
		}		


	}	


		stdSize = Math.sqrt(stdSize);
		stdShade = Math.sqrt(stdShade);
		var SEMSize = stdSize/10;
		var SEMShade = stdShade/10;

	
	
	title.textContent = "Number of members = " + particles.length;
	stats.textContent = "Average size = "  + avgSize + ", Std. size = " + stdSize + "\r, Average shade = " + avgShade + ", Std. shade = " + stdShade;
	
	requestAnimationFrame(drawParticles);
}

function getProportion() {
    var x = document.getElementById("proportion").value;
    document.getElementById("demo").innerHTML = "Emitter red proportion = " + x + "%";
    return x/100;
	
}

function getTrailLength() {
    var x = document.getElementById("trail").value;
    document.getElementById("trails").innerHTML = "Trail persistence = " + x + "%";
    return (100-x)/100;
	
}

function getParticleNumber() {
    var x = document.getElementById("part").value;
    document.getElementById("partNumber").innerHTML = "Number of particles = " + x;
    return x;
	
}


function createParticle(X,Y){
		var randSize = Math.floor(sampleFromNormal(15,3));
		var randShade = Math.floor(sampleFromNormal(125, 40));
		
		//if(randSize > 0 && randShade > 0 && randShade < 255){
		
		var party = new Member(X, Y, randSize, randShade);
		particles.push(party);

		//} else {
		//alert("Out of range! randSize = "+ randSize +" randShade = "+ randShade);
		//}
}

function sampleFromStandardNormal(){

var s = 1;

do{
var u = 2*Math.random() - 1;
var v = 2*Math.random() - 1;

s = Math.pow(u,2) + Math.pow(v,2);
}
while(s >= 1);
var z = u*Math.sqrt(-2*Math.log(s)/s);

return(z);
}

function mapToDist(z, mu, sigma){

return(mu + z*sigma);

}

function sampleFromNormal(mu, sigma){

var crom = sampleFromStandardNormal();

var r = mapToDist(crom, mu, sigma);

return r;

}


/*function createParticle(){
		var randX = 5*(Math.random());
		var randY = canvasHeight*(Math.random());
		var chargey = Math.random();
		if(chargey > getProportion()){
		chargey = 1;
		} else {
		chargey = -1;
		}
		var party = new Particle(0,randY, randX, 0, chargey,1);
		particles.push(party);

}*/


//setupParticles();
//mainContext.fillStyle = "rgba(20,0,0,1)";
mainContext.fillRect(0, 0, canvasWidth, canvasHeight);
drawParticles();	

</script>
</body>
</html>	

